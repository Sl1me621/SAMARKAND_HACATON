# scripts/simple_classifier.py
import re
import json
from typing import Dict, List

class SimpleRuleBasedClassifier:
    def __init__(self):
        self.categories = {
            'it_systems': [
                'jenkins', 'docker', 'gitlab', 'vpn', '—Å–µ—Ä–≤–µ—Ä', '—Å–µ—Ç—å', 'ci/cd',
                '–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä', '–ø–∞–π–ø–ª–∞–π–Ω', 'deploy', 'k8s', 'kubernetes', 'pod',
                'namespace', 'helm', 'ingress', '–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫', 'load balancer',
                'nginx', 'apache', 'ssh', 'remote', '—É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø'
            ],
            'accounting': [
                '1—Å', '–Ω–¥—Å', '–±—É—Ö–≥–∞–ª—Ç–µ—Ä', '–æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å', '–ø—Ä–æ–≤–æ–¥–∫', '–¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è',
                '–Ω–∞–ª–æ–≥', '—Å—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞', '–∫–Ω–∏–≥–∞ –ø–æ–∫—É–ø–æ–∫', '—Ñ–ª–∫', '–æ–±—Å–≤', '–æ—Å–≤',
                '–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–∏–æ–¥–∞', '–ø–±—É', '–∫–¥–∏—Ä', '—É—Å–Ω', '–æ—Å–Ω–æ', '–ø—Ä–∏–±—ã–ª—å',
                '–±–∞–ª–∞–Ω—Å', '–∫–∞—Å—Å–æ–≤—ã–π', '–ø–ª–∞—Ç–µ–∂', '–±–∞–Ω–∫', '–≤—ã–ø–∏—Å–∫–∞'
            ],
            'hardware': [
                '–ø—Ä–∏–Ω—Ç–µ—Ä', '–Ω–æ—É—Ç–±—É–∫', '–º—ã—à–∫', '–º–æ–Ω–∏—Ç–æ—Ä', '–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω', '–∫–ª–∞–≤–∏–∞—Ç—É—Ä',
                '—Å–∫–∞–Ω–µ—Ä', '–∫–∞—Ä—Ç—Ä–∏–¥–∂', '–±–∞—Ç–∞—Ä–µ—è', '–∑–∞—Ä—è–¥–∫', '–¥–æ–∫-—Å—Ç–∞–Ω—Ü', '–Ω–∞—É—à–Ω–∏–∫',
                '–∫–∞–º–µ—Ä–∞', '–ø—Ä–æ–µ–∫—Ç–æ—Ä', '—Ç—Ä–µ–∫–ø–∞–¥', '–∑–≤—É–∫', '–¥–∏–Ω–∞–º–∏–∫', '–º–∏–∫—Ä–æ—Ñ–æ–Ω'
            ],
            'hr': [
                '–æ—Ç–ø—É—Å–∫', '–±–æ–ª—å–Ω–∏—á–Ω', '—Å–ø—Ä–∞–≤–∫', '–∫–∞–¥—Ä', '–≥—Ä–∞—Ñ–∏–∫', '—Ç–∞–±–µ–ª—å',
                '–∑–∞—Ä–ø–ª–∞—Ç', '–æ—Ç–≥—É–ª', '—É–≤–æ–ª—å–Ω–µ–Ω', '–ø—Ä–∏–µ–º', '—Ç—Ä—É–¥–æ–≤–æ–π', '–¥–æ–≥–æ–≤–æ—Ä',
                '—Å—Ç–∞–∂', '–ø—Ä–µ–º–∏—è', '–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫', '—Å—É—Ç–æ—á–Ω', '–±–æ–ª—å–Ω–∏—á–Ω—ã–π', '–æ—Ç–ø—É—Å–∫–Ω—ã–µ',
                '–¥–µ–∫—Ä–µ—Ç', '–æ—Ç–ø—É—Å–∫ –ø–æ', '–≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç'
            ],
            'access': [
                '–¥–æ—Å—Ç—É–ø', '–ø–∞—Ä–æ–ª—å', '–ª–æ–≥–∏–Ω', '—É—á–µ—Ç–Ω', '–ø—Ä–∞–≤–∞', 'ad', 'active directory',
                'ssh', '–∫–ª—é—á', '—Ç–æ–∫–µ–Ω', '–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü', '–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü', 'mfa', '2fa',
                'vdi', 'rdp', 'vpn', '–≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É', '–Ω–µ –º–æ–≥—É –≤–æ–π—Ç–∏'
            ],
            'integration': [
                '–∏–Ω—Ç–µ–≥—Ä–∞—Ü', '—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü', 'crm', 'api', 'webhook', 'rest',
                'soap', '–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å', '–æ—á–µ—Ä–µ–¥—å', 'kafka', 'rabbitmq', '–±—Ä–æ–∫–µ—Ä',
                '–æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏', '–≤—ã–≥—Ä—É–∑–∫–∞', '–∑–∞–≥—Ä—É–∑–∫–∞', '–∏–º–ø–æ—Ä—Ç', '—ç–∫—Å–ø–æ—Ä—Ç'
            ]
        }
    
    def classify_text(self, text: str) -> Dict:
        """–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤"""
        text_lower = text.lower()
        scores = {}
        
        for category, keywords in self.categories.items():
            score = 0
            for keyword in keywords:
                if keyword in text_lower:
                    score += 1
                    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—á–∫–∏ –∑–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                    if f" {keyword} " in f" {text_lower} ":
                        score += 0.5
            scores[category] = score
        
        # –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º
        if sum(scores.values()) == 0:
            best_category = 'other'
            confidence = 0.1
        else:
            best_category = max(scores, key=scores.get)
            max_score = scores[best_category]
            total_possible = len(self.categories[best_category]) * 1.5
            confidence = min(max_score / total_possible, 0.95)
        
        return {
            "category": best_category,
            "confidence": round(confidence, 2),
            "all_scores": scores
        }

def test_classifier():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞"""
    classifier = SimpleRuleBasedClassifier()
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —Ç–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    test_cases = [
        "Jenkins-pipeline –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ build (npm ERR! EACCES), Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è",
        "–ù–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –ø–æ –ù–î–°–° –∑–∞ 3 –∫–≤–∞—Ä—Ç–∞–ª (–æ—à–∏–±–∫–∞ –§–õ–ö 040030001), –∫–Ω–∏–≥–∞ –ø–æ–∫—É–ø–æ–∫ –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è",
        "–ü—Ä–æ—à—É —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –≥–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã 10:00-19:00 –≤–º–µ—Å—Ç–æ 9:00-18:00 —Å 01.11",
        "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è Wi-Fi —Å–µ—Ç—å Corp-Guest –¥–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –Ω–∞ —Ä–µ—Å–µ–ø—à–µ–Ω–µ",
        "–í 1–° –ó–£–ü –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –æ–∫—Ç—è–±—Ä—å (–æ—à–∏–±–∫–∞ ¬´–ù–µ —É–∫–∞–∑–∞–Ω —Ç–∞—Ä–∏—Ñ –§–°–°¬ª)",
        "–ù–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –≤ –ø–æ—á—Ç—É, –ø–∏—à–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å",
        "–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ –±–∞—Ç–∞—Ä–µ–π–∫–∏ –≤ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–π –º—ã—à–∫–µ Logitech MX Master 3S",
        "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ CRM —Å 1–°, –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è"
    ]
    
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞:")
    print("=" * 70)
    
    for i, case in enumerate(test_cases, 1):
        result = classifier.classify_text(case)
        print(f"{i}. {case[:70]}...")
        print(f"   üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {result['category']}")
        print(f"   ‚úÖ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']:.2f}")
        print()

if __name__ == "__main__":
    test_classifier()